var Db = require('Database');
var regist = require('regist');

module.exports = function(req, res, is_login){
	if(is_login){
		var cursor = Db.db.collection('users').find({email: req.cookie['email'], password: req.body.old_password});
		cursor.toArray(function(err, docs){
			if(docs.length!==1){
				res.end(JSON.stringify({message: 'sth wrong, account count!=1'}))
				return;
			}
			var doc=docs[0];
			var redoc=Object.assign({}, doc);
			if(redoc.password.length === 0){
				res.end(JSON.stringify({message: 'your pw is too short'}));
				return;
			}
			redoc.password=req.body.new_password;
			Db.db.collection('users').update(doc,redoc);
			res.end(JSON.stringify({success: true}))
			return;
		});
	}else{
		res.end(JSON.stringify({message: 'you are not login'}))
		return;
	}
}

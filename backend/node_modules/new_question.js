var Db = require('Database');
var config = require('informations.config')
/*
 * We have 5 options(A,B,C,D,E) the answer[] will be the mixture of there
 * options req.body needs data 
 * @String title 
 * @String content 
 * @[String] options
 * @[String] answer 
 * @String solution 
 * @[String] tag 
 * @StringUrl pic 
 * id should be the next Number
 */
module.exports = function(req, res, is_login){
	if(!is_login){
		res.end(JSON.stringify({message: 'You haven\'t login yet'}));
		return;
	}
	if(config.admins.indexOf(req.cookies['email']) !== -1){
		Db.db.collection('Questions').find({}).sort({'id': 1}).toArray().then(function(docs){
			var id;
			console.log(`new_question.js find biggest id => docs`)
			console.log(docs)
			if(docs.length===0){
				id = '1'
			}else{
				id = (parseInt(docs[0]['id'])+1).toString();
			}
			console.log(`new_question.js find biggest id typeof => ${typeof id}`)
			
			Db.db.collection('Questions').insertOne({
				id: id,
				title: req.body['title'],
				content: req.body['content'],
				options: req.body['options'],
				answer: req.body['answer'],
				solution: req.body['solution'],
				tag: req.body['tag'],
				pic: req.body['pic']
			}).then(function(result){
				res.end(JSON.stringify({
					success: result
				}))
			return;
			}).catch(function(err){
					console.log(err);
					res.end(JSON.stringify({
						message: 'err occured'
					}));
					return;
			})
		}).catch(function(err){
			console.log(err);
			res.end(JSON.stringify({message: 'err occured'}))
			return;
		})
	}
}
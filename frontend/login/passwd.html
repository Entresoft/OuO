<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link rel="stylesheet" href="http://cdn.rawgit.com/TeaMeow/TocasUI/master/dist/tocas.min.css">
		<script src="js/jquery.min.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="form" style="margin: 10% 30%">
 			<div class="ts vertical inputs">
    		<div class="ts fluid input">
        	<input id="old-password" type="password" placeholder="舊密碼">
    		</div>
    		<div class="ts fluid input">
        	<input id="old-password-repeat" type="password" placeholder="重複一次舊密碼">
    		</div>
    		<div class="ts fluid input">
        	<input id="new-password" type="password" placeholder="新密碼">
    		</div>
    		<div class="ts fluid input">
        	<input id="new-password-repeat" type="password" placeholder="重複一次新密碼">
    		</div>
			</div><br/>
			<button id="submit" class="ts positive basic button" onclick="send()">Submit!</button>
		</div>
		<div id="some-info" class="panel-info"></div>
	</body>
	<script src="../config.js"></script>
	<script>
		$('#some-info').hide();
		$.ajax({
			type: 'GET',
			url: domain+'/api/is_login',
			success: function(res){
				if(!res['login']){
					$('#form').hide();
					$('#some-info').show();
					$('#some-info').text('You are not login!');
				}
			},
			error: function(xhr){
				console.log(xhr);	
			},
			xhrFields: {
				withCredentials: true
			}
		})
		window.onload = function(){}
		function send(){
			var old_pw = $('#old-password').val();
			var old_pw_re = $('#old-password-repeat').val();
			var new-pw = $('#new-password').val();
			var new-pw-re = $('#new-password-repeat').val();
			if(old_pw !== '' && new_pw !== '' &&
				 old_pw === old_pw_re && new_pw === new_pw_re){
				$.ajax({
					type: 'POST',
					url: domain+'/api/passwd',
					dataType: 'json',
					data: {old_password: old_pw, new_password: new_pw},
					success: function(res){
						if(res['success']){
							$('#some-info').show();
							$('#some-info').text('Ok! well done!');
						}else{
							$('#some-info').show();
							$('#some-info').text('Oops! sth went wrong '+res['message'])
						}
					},
					error: function(xhr){
						console.log(xhr);
					},
					xhrFields: {
						withCredentials: true
					}
				})
			}else{
				$('#some-info').show();
				$('#some-info').text('You have to fill the form by rule');
			}
		}
	</script>
</html>
